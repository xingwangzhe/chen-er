[中文](README.zh.md)

# Chen ER (ECharts version)

A small front-end library that parses a concise ER DSL and renders classic Chen ER diagrams. It uses Peggy to generate the parser and ECharts to auto-layout & visualize.

![img](img.webp)


## Features
- Parse ER text: entities, attributes, relations (with cardinality)
- Classic Chen style: entity = rectangle, relation = diamond, attribute = ellipse
- Auto layout: ECharts `graph` force layout (roam/drag enabled)
- Lightweight: only `echarts` and `peggy`; built as a library via Vite (ES/UMD)
 - Rich hover tooltips:
   - Hover relation: shows relation name, participating entities (A:B), and cardinality (e.g., 1:N)
   - Hover entity: shows class name and its attributes (primary keys marked with `*`)

## Install
```bash
bun add chen-er
# or
npm i chen-er
```

Developing in this repo:
```bash
bun run pg      # generate parser grammar/peggy/all-parser.js (ESM)
bun run dev     # local demo
bun run build   # outputs index.js / index.umd.js under dist; types at dist/types/index.d.ts
```

## Usage

### ES module
```ts
// Named export
import { chenERRbyClass, chenERRbyId } from 'chen-er'
// Render all containers with class 'chenER'
chenERRbyClass('chenER')
// Render single container by id
chenERRbyId('my-er-container')

// Default export (object)
import ChenER from 'chen-er'
ChenER.chenERRbyClass('chenER')
ChenER.chenERRbyId('my-er-container')
```

### ES module via CDN (self-contained)
```html
<script type="module">
  import { chenERRbyClass, chenERRbyId } from 'https://cdn.jsdelivr.net/npm/chen-er@latest/dist/index.ems.js'
  chenERRbyClass('chenER')
  // chenERRbyId('my-er-container')
</script>
```

### UMD (script tag via jsDelivr, self-contained)
```html
<script src="https://cdn.jsdelivr.net/npm/chen-er@latest/dist/index.umd.js"></script>
<script>
  ChenER.chenERRbyClass('chenER')
  // ChenER.chenERRbyId('my-er-container')
</script>
```
Note: the UMD global is `ChenER` with `chenERRbyClass` and `chenERRbyId`.

### Grammar Summary
- Comments: `# ...` (single-line)
- Whitespace: spaces/tabs/newlines act as separators
- Identifier: Unicode letters and digits supported (e.g., `名称`, `email`)
- Entity:
  - Form: `entity <Name> { <field-line>... }`
  - Field line: `<fieldName> [PK]` (optional `PK` marks primary key)
- Relation:
  - Form: `rel <EntityA> -- <EntityB> : (<Cardinality>) "<RelationName>"`
  - Cardinality: `1:1`, `1:n`, `m:n`, etc.

## ER text example
```
entity Customer {
  customer_id PK
  name
  email
}

entity Order {
  order_id PK
  order_date
}

rel Customer -- Order : (1:n) "places"
```


## API
- `chenERRbyClass(erTag?: string): void`
  - `erTag`: container class name; default `"chenER"`
  - Reads each matching container’s text, parses it, and renders an ECharts graph
- `chenERRbyId(id: string): void`
  - Render a single container by `id`
- Default export: `{ chenERRbyClass, chenERRbyId }`

## Build & Publish
 - Vite library mode outputs:
   - `dist/index.js` (ES, externalized deps, for bundlers)
   - `dist/index.ems.js` (ESM, self-contained for CDN)
   - `dist/index.umd.js` (UMD, self-contained for CDN)
 - Types entry: `dist/types/index.d.ts`
 - `package.json` `files: ["dist", "LICENSE"]` publishes build artifacts and license.

## Notes
 - Parser is generated by Peggy (ESM). Run `bun run pg` before build.
 - Browsers need only the built library and `echarts`; no `.peggy` sources.
 - Container text supports Chinese and comments (line comments with `#`, Unicode identifiers).

## Notes
- Parser is generated by Peggy (ESM). Run `bun run pg` before build.
- Browsers need only the built library and `echarts`; no `.peggy` sources.
- Unicode identifiers and line comments (starting with `#`) are supported.

---
If you need: ELK layered layout, multi-valued/derived attribute markers, or relation cardinality labels, please open an issue.
