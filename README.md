[中文](README.zh.md)

# Chen ER (ECharts version)

A small front-end library that parses a concise ER DSL and renders classic Chen ER diagrams. It uses Peggy to generate the parser and ECharts to auto-layout & visualize.

![img](img.webp)


## Features
- Parse ER text: entities, attributes, relations (with cardinality)
- Classic Chen style: entity = rectangle, relation = diamond, attribute = ellipse
- Auto layout: ECharts `graph` force layout (roam/drag enabled)
- Lightweight: only `echarts` and `peggy`; built as a library via Vite (ES/UMD)
 - Rich hover tooltips:
   - Hover relation: shows relation name, participating entities (A:B), and cardinality (e.g., 1:N)
   - Hover entity: shows class name and its attributes (primary keys marked with `*`)

## Install
```bash
bun add chen-er
# or
npm i chen-er
```

Developing in this repo:
```bash
bun run pg      # generate parser grammar/peggy/all-parser.js (ESM)
bun run dev     # local demo
bun run build   # output dist/chen-er.es.js, dist/chen-er.umd.js
```

## Usage

### ES module
```ts
// Named export
import { renderChenER, chenERRender } from 'chen-er/dist/chen-er.es.js'
renderChenER('chenER')
chenERRender('chenER')

// Default export (object with renderChenER)
import ChenER from 'chen-er/dist/chen-er.es.js'
ChenER.renderChenER('chenER')
```

### UMD (script tag)
```html
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
<script src="./dist/chen-er.umd.js"></script>
<script>
  // Render the container with class chenER
  ChenER.renderChenER('chenER')
</script>
```
Note: the UMD bundle exposes a global object with `renderChenER` only. Use `ChenER.renderChenER`.

### Grammar Summary
- Comments: `# ...` (single-line)
- Whitespace: spaces/tabs/newlines act as separators
- Identifier: Unicode letters and digits supported (e.g., `名称`, `email`)
- Entity:
  - Form: `entity <Name> { <field-line>... }`
  - Field line: `<fieldName> [PK]` (optional `PK` marks primary key)
- Relation:
  - Form: `rel <EntityA> -- <EntityB> : (<Cardinality>) "<RelationName>"`
  - Cardinality: `1:1`, `1:n`, `m:n`, etc.

## ER text example
```
entity Customer {
  customer_id PK
  name
  email
}

entity Order {
  order_id PK
  order_date
}

rel Customer -- Order : (1:n) "places"
```


## API
- `renderChenER(erTag?: string): void`
  - `erTag`: container class name; default `"chenER"`
  - Reads the container text, parses it, and renders an ECharts graph
- Compatible alias: `chenERRender`
- Default export: `{ renderChenER }`

## Build & Publish
 - Built with Vite library mode; output: `dist/chen-er.es.js`, `dist/chen-er.umd.js`
 - `package.json` `files: ["dist"]` publishes only build artifacts.
 - `.npmignore` excludes sources and demo files.

## Notes
 - Parser is generated by Peggy (ESM). Run `bun run pg` before build.
 - Browsers need only the built library and `echarts`; no `.peggy` sources.
 - Container text supports Chinese and comments (line comments with `#`, Unicode identifiers).

## Notes
- Parser is generated by Peggy (ESM). Run `bun run pg` before build.
- Browsers need only the built library and `echarts`; no `.peggy` sources.
- Unicode identifiers and line comments (starting with `#`) are supported.

---
If you need: ELK layered layout, multi-valued/derived attribute markers, or relation cardinality labels, please open an issue.
